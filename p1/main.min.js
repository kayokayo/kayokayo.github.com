var __reflect=this&&this.__reflect||function(t,e,r){t.__class__=e,r?r.push(e):r=[e],t.__types__=t.__types__?r.concat(t.__types__):r},__extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,r){function i(i){e.call(r,i,t)}if(RES.hasRes(t)){var o=RES.getRes(t);o?i(o):RES.getResAsync(t,i,this)}else RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isThemeLoadEnd=!1,e.isResourceLoadEnd=!1,e.txtNums=[0,0,0,0,0,0],e.arr=[],e.srcArr=[0,1,2,3,4,5],e.num=3,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this);var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},e.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startGame()},e.prototype.startGame=function(){this.initAnswerTxt(),this.updateGame()},e.prototype.updateGame=function(){this.createColorTxt(),this.createColorButtons()},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.initAnswerTxt=function(){if(!this.txtItems){this.txtItems=[];var t,e=new egret.Sprite;this.addChild(e);for(var r=0;6>r;r++)t=this.getTxtItem(r+1),e.addChild(t),this.txtItems.push(t),t.y=(t.height+20)*r;e.x=.9*this.stage.stageWidth,e.y=.1*this.stage.stageHeight}},e.prototype.updateAnswerTxt=function(t){this.txtNums[t]+=1;var e=this.txtItems[t],r=e.getChildAt(1);r.text="X "+this.txtNums[t]},e.prototype.getTxtItem=function(t){var e=new egret.Sprite,r=this.createBitmapByName(t+"_png");e.addChild(r);var i=new egret.TextField;return i.text="X 0",i.size=30,i.textColor=0,e.addChild(i),i.x=r.width*r.scaleX+10,i.y=.5*(r.height*r.scaleY-i.height),e},e.prototype.createColorTxt=function(){var t=Math.floor(6*Math.random());this.crtIndex=t,t+=9,this.colorTxt||(this.colorTxtCon=new egret.Sprite,this.addChild(this.colorTxtCon),this.colorTxt=new egret.Bitmap,this.colorTxtCon.addChild(this.colorTxt)),this.colorTxt.texture=RES.getRes(t+"_png"),this.colorTxt.scaleX=3,this.colorTxt.scaleY=3,this.colorTxtCon.x=.5*(this.stage.stageWidth-this.colorTxtCon.width),this.colorTxtCon.y=.3*this.stage.stageHeight},e.prototype.createColorButtons=function(){this.group||(this.group=new egret.Sprite,this.group.x=20,this.group.y=20,this.addChild(this.group)),this.group.removeChildren(),this.arr.length=0,this.arr.push(this.crtIndex),this.srcArr=[0,1,2,3,4,5],this.srcArr.splice(this.srcArr.indexOf(this.crtIndex),1);for(var t,e,r=0;r<this.num-1;r++)e=Math.floor(Math.random()*this.srcArr.length),t=this.srcArr[e],this.arr.push(t),this.srcArr.splice(e,1);for(var i=0;i<this.arr.length;i++){var o=this.getColorSprite(this.arr[i]+1);o.touchEnabled=!0;var s=2.5;o.scaleX*=s,o.scaleY*=s,this.group.addChild(o),o.x=i*(60+o.width*s),o.name=this.arr[i]+"",o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onColorSpritTouch,this)}this.group.y=.6*this.stage.stageHeight,this.group.x=.5*(this.stage.stageWidth-this.group.width)},e.prototype.onColorSpritTouch=function(t){var e=t.currentTarget.name==this.crtIndex;console.log(e,t.currentTarget.name,this.crtIndex),this.showTrueNoPic(e,t.currentTarget),e&&this.updateAnswerTxt(this.crtIndex),this.t||(this.t=new egret.Timer(500,1),this.t.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this)),this.t.start()},e.prototype.timerComFunc=function(t){console.log("over"),this.truenoBmp.visible=!1,this.num++,this.num>6&&(this.num=6),this.updateGame()},e.prototype.showTrueNoPic=function(t,e){this.truenoBmp||(this.truenoBmp=new egret.Bitmap,this.addChild(this.truenoBmp)),this.truenoBmp.visible=!0,this.truenoBmp.texture=t?RES.getRes("7_png"):RES.getRes("8_png"),this.truenoBmp.scaleX=this.truenoBmp.scaleY=2,this.truenoBmp.x=e.x+e.parent.x+.5*(e.width*e.scaleX-this.truenoBmp.width*this.truenoBmp.scaleX),this.truenoBmp.y=e.parent.y+e.parent.height+20},e.prototype.getColorSprite=function(t){var e=new egret.Sprite;return e.addChild(this.createBitmapByName(t+"_png")),e},e.prototype.startCreateScene=function(){var t=this.createBitmapByName("bg_jpg");this.addChild(t);var e=this.stage.stageWidth,r=this.stage.stageHeight;t.width=e,t.height=r;var i=new egret.Shape;i.graphics.beginFill(0,.5),i.graphics.drawRect(0,0,e,172),i.graphics.endFill(),i.y=33,this.addChild(i);var o=this.createBitmapByName("egret_icon_png");this.addChild(o),o.x=26,o.y=33;var s=new egret.Shape;s.graphics.lineStyle(2,16777215),s.graphics.moveTo(0,0),s.graphics.lineTo(0,117),s.graphics.endFill(),s.x=172,s.y=61,this.addChild(s);var n=new egret.TextField;n.textColor=16777215,n.width=e-172,n.textAlign="center",n.text="Hello Egret",n.size=24,n.x=172,n.y=80,this.addChild(n);var h=new egret.TextField;this.addChild(h),h.alpha=0,h.width=e-172,h.textAlign=egret.HorizontalAlign.CENTER,h.size=24,h.textColor=16777215,h.x=172,h.y=135,this.textfield=h,RES.getResAsync("description_json",this.startAnimation,this);var a=new eui.Button;a.label="Click!",a.horizontalCenter=0,a.verticalCenter=0,this.addChild(a),a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onButtonClick,this)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,r=RES.getRes(t);return e.texture=r,e},e.prototype.startAnimation=function(t){var e=this,r=new egret.HtmlTextParser,i=t.map(function(t){return r.parse(t)}),o=this.textfield,s=-1,n=function(){s++,s>=i.length&&(s=0);var t=i[s];o.textFlow=t;var r=egret.Tween.get(o);r.to({alpha:1},200),r.wait(2e3),r.to({alpha:0},200),r.call(n,e)};n()},e.prototype.onButtonClick=function(t){var e=new eui.Panel;e.title="Title",e.horizontalCenter=0,e.verticalCenter=0,this.addChild(e)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,r,i){function o(t){e.call(i,t)}function s(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),r.call(i))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);